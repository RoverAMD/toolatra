image::logo.png[]

= Toolatra

http://meow.roveramd.com/s/map/toolatra

The simplicity of Sinatra brought to Tcl.

[source,tcl]
----
package require Toolatra

get / {
	show "Good morning!"
}

run
----


*Toolatra* is a micro web framework that is very similar to Sinatra, but is ported to Tcl.

== What does it have?
[squares]
- Sinatra-like syntax
- Minimalistic templates
- Built-in web server that integrates easily with Nginx or Apache

== Installation
=== On macOS

[source,bash]
----
$ tclsh8.5 install-macos.tcl
----

=== On Ubuntu Linux

[source,bash]
----
$ sudo sh
$ mkdir -v /usr/share/tcltk/toolatra
$ cp -r -v *.tcl /usr/share/tcltk/toolatra/
$ exit
----

== Usage
Handling a GET request to a specific path:

[source,tcl]
----
package require Toolatra

get / {
	show {Hello there, stranger!}
}

run
----

If you save and run this file with tclsh and then go to http://127.0.0.1:5050, you should see ``Hello there, stranger!``.

_SPOILER!_ Specifying the port number on which the server should be ran to the ``run`` command will start Toolatra's server on that port.

Throwing HTTP errors:

[source,tcl]
----
package require Toolatra

get /this-will-cause-an-error {
	error 404
}

run
----


By default, Toolatra's ugly error handler will be used. To replace it with a custom one, just define a GET request handler with the path set to ``/<HTML error code here>``. Example:

[source,tcl]
----
package require Toolatra

get /404 {
	show "Whoops, an error has occured."
}

get /this-will-cause-an-error {
	error 404
}

run
----

Serving additional headers:

[source,tcl]
----
package require Toolatra

get / {
	header Content-type text/plain
	show {Look, I'm plain text!}
}

run
----

Using templates:

[source,tcl]
----
package require Toolatra
package require ToolatraTemplates

get / {
	etcl index.html [dict create name Tim]
}

run
----

Example contents of ``index.html`` (it must be located in ``templates`` folder):

[source,html]
----
<h1>Hello there, @name@!</h1>
<p>Did you know that I can run Tcl code from here? Just look: 2 + 2 = @expr {2+2}@</p>
----

Accessing query string parameters:

[source,tcl]
-----
package require Toolatra
package require ToolatraTemplates

get / {
	if {[dict exists $params name]} {
		show "Hello, [dict get $params name]!"
	} else {
		etcl form.html
	}
}

run
-----

``form.html`` template:

[source,html]
----
<form method=GET action=/>
<p>Your name: <input type="text" name=name /></p> <button type=submit>Greet me!</button>
</form>
----

This Tcl wiki page contains some useful examples on using templates and layouts: https://wiki.tcl-lang.org/page/Toolatra

Accessing header values:

[source,tcl]
----
package require Toolatra

get / {
	if {[dict exists $params User-Agent]} {
		show [dict get $params User-Agent]
	} else {
		show None
	}
}

run
----

Redirecting to other pages:

[source,tcl]
----
package require Toolatra

get / {
	redirect http://example.com
}


run
----

Handling POST requests with data:

[source,tcl]
----
package require Toolatra

post / {
	render "Data sent: $rawData"
}

get / {
	render "Params/headers sent: $params"
}

run
----

Handling cookies:

[source,tcl]
----
package require Toolatra 19.12

get / {
	if {[cookie token] != {}} {
		show "Cookie 'token' is set to [cookie token]"
	} else {
		redirect /settoken
	}
}

get /settoken {
	cookie token [expr {int(rand() * 9999)}]
}
----

== License
As always, MIT License.
